<script lang="ts">
	import moment from 'moment';
	import { Avatar, Table, tableMapperValues, type TableSource } from '@skeletonlabs/skeleton';
	import * as FdjForecastCore from 'fdj-forecast-core';

	const rollNeuralNetworkService = new FdjForecastCore.RollNeuralNetworkService();
	rollNeuralNetworkService.load(
		JSON.parse(
			'{"type":"NeuralNetworkGPU","sizes":[3,9,49],"layers":[{"weights":[],"biases":[]},{"weights":[[-0.8170883655548096,-1.8484700918197632,-60.162044525146484],[-3.220669746398926,-71.207763671875,49.293128967285156],[-1.1838165521621704,-1.9329524040222168,-0.28775542974472046],[-1.3379261493682861,56.14497756958008,-51.7008171081543],[-1.3994837999343872,-0.614589512348175,-0.3936249613761902],[-1.3609304428100586,-11.492472648620605,49.486690521240234],[-0.39282679557800293,-67.1619873046875,-49.52095413208008],[-1.3088128566741943,-0.37318843603134155,0.293423056602478],[-1.37841796875,23.260530471801758,7.428709983825684]],"biases":[-1.560978889465332,-3.365445137023926,-4.73681640625,-8.005730628967285,-5.630618572235107,-4.359005928039551,-0.6849463582038879,-5.761804103851318,-4.5125555992126465]},{"weights":[[0.2042517215013504,-0.246016263961792,-0.6168600916862488,-5.891558647155762,-0.9054309725761414,-0.7723240256309509,-2.589993953704834,-0.6602378487586975,0.5042665004730225],[-2.2223613262176514,2.734506368637085,-0.24583430588245392,2.9898500442504883,-0.649437665939331,-2.1011643409729004,-1.4457547664642334,-0.47521987557411194,-1.9188721179962158],[2.3662376403808594,-5.211038112640381,-0.4053557813167572,-3.373403787612915,-0.6832272410392761,0.06235935539007187,-4.802159786224365,-0.4221915602684021,-0.22165878117084503],[3.595043659210205,-4.770555019378662,-0.6709253787994385,4.632025718688965,-0.7196251153945923,5.676722526550293,5.3058624267578125,-0.5124855041503906,-1.0307968854904175],[6.384864807128906,-2.1680357456207275,-0.7637483477592468,-0.8954921364784241,-0.7832939028739929,6.319499969482422,0.27223965525627136,-0.5530142188072205,1.6153827905654907],[-2.8713371753692627,0.2642670273780823,-0.978416383266449,1.9564709663391113,-0.8467353582382202,-3.2621724605560303,-1.0113813877105713,-0.5655481815338135,1.0148000717163086],[-6.327935695648193,-6.622210502624512,-0.6840081810951233,1.7081913948059082,-0.6912024021148682,-4.907530307769775,4.749939441680908,-0.7889127731323242,0.1394687294960022],[1.3338698148727417,5.344111442565918,-0.7199006080627441,2.1230037212371826,-0.5887330174446106,-0.018379928544163704,5.900391101837158,-0.7028136849403381,1.026091456413269],[-0.11947780102491379,-2.934584379196167,-0.5121232867240906,-0.4482618272304535,-0.6064339280128479,0.12069464474916458,0.35712137818336487,-0.634334921836853,-1.5231748819351196],[-3.9881913661956787,0.7201805710792542,-0.6565081477165222,-1.0890682935714722,-0.8097341656684875,-2.116400718688965,-4.649221897125244,-0.6253846287727356,0.5680215358734131],[1.9566463232040405,-6.384509086608887,0.053300514817237854,-1.4741019010543823,-0.47257986664772034,1.5313572883605957,-6.14224100112915,-0.5342910885810852,-4.2076849937438965],[-6.424646377563477,3.7544350624084473,-0.3551247715950012,-2.359375238418579,-0.43051645159721375,-6.197997570037842,-0.8286171555519104,-0.6812275052070618,-2.4319310188293457],[2.8657689094543457,1.9479342699050903,-0.5667923092842102,3.7476606369018555,-0.6897692084312439,0.5179587602615356,-7.88695764541626,-0.6232700347900391,-1.3191760778427124],[-0.2367645800113678,1.5230094194412231,-0.9710326790809631,0.5605652928352356,-0.7336615324020386,-1.6704078912734985,3.3979318141937256,-0.8672033548355103,1.1655364036560059],[1.0620578527450562,2.4927995204925537,-0.5643024444580078,-1.2757947444915771,-0.5352843403816223,0.3034312427043915,1.3729546070098877,-0.5874806046485901,-0.09729275852441788],[3.3182053565979004,0.4985201060771942,-0.3444158136844635,2.266876459121704,-0.43382027745246887,0.4671242833137512,-4.97247838973999,-0.5728242993354797,-2.658306837081909],[4.481151580810547,2.27437686920166,-0.5845742225646973,1.6327954530715942,-0.656655490398407,1.5627553462982178,1.8712226152420044,-0.5836679935455322,2.4484806060791016],[0.1698320060968399,1.5005320310592651,-0.6925714612007141,-10.252310752868652,-0.7332300543785095,-1.078628420829773,-4.765505790710449,-0.4260009527206421,1.931135892868042],[-4.583903789520264,-0.6753193736076355,-0.5863909125328064,1.4490221738815308,-0.7344128489494324,-3.670938730239868,0.44108283519744873,-0.5386564135551453,-1.7245111465454102],[-1.5164763927459717,-4.929996967315674,-0.8751781582832336,-0.07918395102024078,-0.6431592106819153,-0.9763855338096619,5.269918441772461,-0.7866182923316956,1.8342548608779907],[-2.8685619831085205,-8.229793548583984,-0.9083592295646667,5.208561897277832,-0.8656986355781555,0.5455148220062256,5.037848472595215,-0.6271891593933105,-0.38114669919013977],[-4.035889625549316,-9.40207576751709,-0.18640899658203125,3.0838065147399902,-0.5260831713676453,-0.3183916509151459,2.7977395057678223,-0.4514825940132141,-3.4177122116088867],[1.5532972812652588,-8.510088920593262,-0.16167789697647095,-0.7710296511650085,-0.42794373631477356,2.143744707107544,-1.318373203277588,-0.3083180785179138,-2.065065622329712],[4.493603229522705,-0.5396653413772583,-0.8822453022003174,1.5516078472137451,-0.864855170249939,4.5172834396362305,2.8153676986694336,-0.7022293210029602,0.9755428433418274],[-0.09140466898679733,-0.5003910660743713,-0.30297285318374634,5.177610397338867,-0.6587761044502258,-1.029793381690979,-5.113927364349365,-0.5936439037322998,-2.2597293853759766],[0.3924526274204254,1.5921989679336548,-0.3004250228404999,-4.384820461273193,-0.4302669167518616,-0.5647998452186584,0.39083465933799744,-0.34825897216796875,-0.4209177494049072],[-0.9634311199188232,-2.965224027633667,-0.43291181325912476,-6.470196723937988,-0.5503944158554077,-1.830589771270752,-0.025957047939300537,-0.507359504699707,-1.6553003787994385],[2.669706344604492,-0.3104618787765503,-0.16512812674045563,-3.910001039505005,-0.552433967590332,-0.6060277819633484,-2.5286972522735596,-0.6800023317337036,-2.3117735385894775],[3.031212091445923,-1.0676476955413818,-0.967053234577179,-2.675593614578247,-0.9956567883491516,3.404799699783325,-2.1567516326904297,-0.6016772389411926,3.031996011734009],[1.2582190036773682,0.6303871870040894,-0.0326654426753521,-6.724643230438232,-0.5487169027328491,1.3422396183013916,-3.2738027572631836,-0.40899452567100525,-3.07759690284729],[4.065424919128418,4.982137203216553,-0.943729043006897,-5.740849494934082,-0.86160808801651,-0.5545930862426758,-2.720583438873291,-0.7821961641311646,3.969083547592163],[-3.3596487045288086,1.1569713354110718,-1.2027441263198853,1.5114647150039673,-0.8911773562431335,1.750600814819336,4.476497650146484,-0.5418140888214111,2.9056034088134766],[-4.463156223297119,3.4514622688293457,-0.33952796459198,-0.5589142441749573,-0.6297351121902466,-3.938314199447632,-2.730746269226074,-0.5019826292991638,-0.7859781980514526],[-1.9171690940856934,2.8774538040161133,-0.7810713648796082,-1.120666742324829,-0.7735481858253479,-1.7767659425735474,2.1743931770324707,-0.7323864698410034,0.3279464542865753],[-9.848196983337402,5.097323417663574,-0.6416537761688232,5.177546977996826,-0.8718181848526001,-4.708591461181641,7.48828649520874,-0.6910620331764221,-0.5183048248291016],[1.786490559577942,-6.663623332977295,-0.17409561574459076,-1.0774911642074585,-0.5640984177589417,4.206356048583984,-1.9040640592575073,-0.48391959071159363,-1.0340476036071777],[-3.6126794815063477,0.40559837222099304,-0.13398653268814087,0.5611419081687927,-0.6584131121635437,0.8236117959022522,-1.8685508966445923,-0.545956552028656,-3.7359580993652344],[3.2275938987731934,-0.6949186325073242,-0.8828279972076416,-2.519749402999878,-1.0057220458984375,5.507804870605469,-4.515936851501465,-0.5681142210960388,2.3598198890686035],[-4.229855060577393,4.808479309082031,-1.0809414386749268,7.1899309158325195,-0.8806231617927551,-2.5341598987579346,2.9315550327301025,-0.7836219668388367,1.4033387899398804],[-0.287526398897171,1.962261438369751,-0.637798547744751,-4.9592437744140625,-0.5417210459709167,-1.810072422027588,6.652014255523682,-0.5470262169837952,2.8780605792999268],[0.15083830058574677,-1.0593940019607544,-0.2869643270969391,-1.413989782333374,-0.4966108798980713,-0.773529052734375,-4.948473930358887,-0.5891626477241516,-1.1967087984085083],[-1.953220009803772,4.283028602600098,-0.11901142448186874,9.545938491821289,-0.28581535816192627,-3.76714825630188,1.183914303779602,-0.7057552933692932,-5.02352237701416],[-3.022879123687744,2.612710952758789,-0.37488651275634766,4.339191436767578,-0.7865486145019531,-0.5030221939086914,3.3918139934539795,-0.38983154296875,0.3407360017299652],[2.195009708404541,2.778658628463745,-0.6621403694152832,-2.6022188663482666,-0.40748128294944763,0.042049139738082886,-1.6680083274841309,-0.6330886483192444,0.9152565002441406],[6.529865741729736,-6.240847110748291,-0.5241893529891968,2.475355625152588,-0.740187406539917,7.931856632232666,-9.330665588378906,-0.7243180871009827,-0.7216909527778625],[4.911630153656006,-1.0385745763778687,-0.8497759699821472,-4.530303955078125,-0.5990156531333923,0.926397979259491,1.930989384651184,-0.7112911343574524,4.047548294067383],[-3.321845054626465,-5.559483528137207,-0.5851196646690369,6.263067722320557,-0.7400157451629639,2.641023635864258,0.38060909509658813,-0.5324029326438904,-2.1073317527770996],[2.05013108253479,-3.1360325813293457,-0.989503026008606,-1.2687203884124756,-0.8273934721946716,1.948973298072815,3.254643678665161,-0.617504358291626,1.5816274881362915],[0.6852694749832153,6.110820770263672,-1.2094733715057373,-2.829110622406006,-0.7429965734481812,-3.7217774391174316,-11.93669319152832,-0.8218175768852234,2.8684959411621094]],"biases":[-2.113485097885132,-2.020820379257202,-2.0857691764831543,-2.605705738067627,-2.7769992351531982,-2.101008415222168,-1.9404770135879517,-2.3039333820343018,-2.1076228618621826,-1.9211010932922363,-2.0246617794036865,-1.4496078491210938,-2.2201087474823,-2.3219923973083496,-2.356741189956665,-2.30111026763916,-2.4895646572113037,-1.944995641708374,-1.8831859827041626,-2.0508995056152344,-2.031809091567993,-1.8168569803237915,-2.009737014770508,-2.7814295291900635,-2.0467495918273926,-2.1427414417266846,-1.987473726272583,-2.1298203468322754,-2.388894557952881,-1.9154515266418457,-2.6725313663482666,-2.5114517211914062,-1.636617660522461,-2.1838767528533936,-1.7808672189712524,-2.1672892570495605,-1.9522757530212402,-2.7285780906677246,-2.145778179168701,-2.3258633613586426,-1.8277357816696167,-2.0036230087280273,-2.3394534587860107,-2.2751524448394775,-2.430474042892456,-2.4281046390533447,-2.1117985248565674,-2.2542848587036133,-2.2001326084136963]}],"inputLookup":null,"inputLookupLength":0,"outputLookup":{"1":23,"2":37,"3":10,"4":0,"5":29,"6":38,"7":47,"8":26,"9":35,"10":39,"11":13,"12":48,"13":43,"14":1,"15":20,"16":5,"17":11,"18":30,"19":33,"20":6,"21":27,"22":17,"23":24,"24":28,"25":18,"26":40,"27":46,"28":2,"29":21,"30":34,"31":7,"32":3,"33":8,"34":42,"35":19,"36":41,"37":4,"38":45,"39":31,"40":14,"41":22,"42":44,"43":15,"44":32,"45":36,"46":9,"47":12,"48":16,"49":25},"outputLookupLength":49,"options":{"inputSize":0,"outputSize":0,"binaryThresh":0.5,"hiddenLayers":[9]},"trainOpts":{"activation":"sigmoid","iterations":20000,"errorThresh":0.005,"log":true,"logPeriod":10,"leakyReluAlpha":0.01,"learningRate":0.3,"momentum":0.1,"callbackPeriod":10,"timeout":"Infinity","beta1":0.9,"beta2":0.999,"epsilon":1e-8}}'
		)
	);
	const magicNeuralNetworkService = new FdjForecastCore.MagicNeuralNetworkService();
	magicNeuralNetworkService.load(
		JSON.parse(
			'{"type":"NeuralNetworkGPU","sizes":[3,3,10],"layers":[{"weights":[],"biases":[]},{"weights":[[-0.3484189808368683,28.035017013549805,-40.37982940673828],[0.733845055103302,-37.14667892456055,14.31517219543457],[0.345807284116745,-12.028787612915039,-18.900074005126953]],"biases":[-4.95814323425293,-1.1968624591827393,-0.8880982398986816]},{"weights":[[-0.8068798184394836,-0.046647824347019196,0.6750347018241882],[2.4381611347198486,1.5178563594818115,-0.5869430303573608],[-6.862255096435547,-3.6516034603118896,5.03936243057251],[-5.45543098449707,0.41575008630752563,-1.0977072715759277],[-5.166920185089111,-0.6852343678474426,-1.2921557426452637],[8.620466232299805,1.2921379804611206,0.5332140326499939],[1.5514147281646729,-0.09932591766119003,-0.3487423062324524],[-3.8284497261047363,-0.0931238979101181,-0.9324855804443359],[-2.623185396194458,-3.427624464035034,2.559316873550415],[6.0953803062438965,2.0569427013397217,-3.777681827545166]],"biases":[-2.284334659576416,-2.301802158355713,-2.4172065258026123,-2.022054433822632,-1.9430094957351685,-2.6831014156341553,-2.2154862880706787,-1.7447013854980469,-2.24211049079895,-2.150946855545044]}],"inputLookup":null,"inputLookupLength":0,"outputLookup":{"1":8,"2":2,"3":4,"4":0,"5":1,"6":5,"7":6,"8":9,"9":7,"10":3},"outputLookupLength":10,"options":{"inputSize":0,"outputSize":0,"binaryThresh":0.5,"hiddenLayers":[3]},"trainOpts":{"activation":"sigmoid","iterations":20000,"errorThresh":0.005,"log":true,"logPeriod":10,"leakyReluAlpha":0.01,"learningRate":0.3,"momentum":0.1,"callbackPeriod":10,"timeout":"Infinity","beta1":0.9,"beta2":0.999,"epsilon":1e-8}}'
		)
	);

	const dateNow = new Date();
	const dates: Date[] = [];
	for (let i = 0; i < 150; i++) {
		const iDate = new Date(dateNow);
		iDate.setDate(iDate.getDate() + i);
		dates.push(iDate);
	}

	const sourceData = [];
	for (const date of dates) {
		const momentDate = moment(date);
		if (
			momentDate.format('dddd') === 'Monday' ||
			momentDate.format('dddd') === 'Wednesday' ||
			momentDate.format('dddd') === 'Friday'
		) {
			const roll = rollNeuralNetworkService.forecast(date);
			const magic = magicNeuralNetworkService.forecast(date);

			sourceData.push({
				date: moment(date).format('dddd Do MMMM'),
				roll: roll.reduce((current, next) => {
					if (current === '') {
						current = `${next}`;
					} else {
						current = `${current} - ${next}`;
					}

					return current;
				}, ''),
				magic
			});
		}
	}

	const tableSimple: TableSource = {
		head: ['Date', 'Roll', 'Magic'],
		body: tableMapperValues(sourceData, ['date', 'roll', 'magic'])
	};
</script>

<svelte:head>
	<title>FDJ Forecast - Artificial intelligence for the French lottery (Fran√ßaise Des Jeux)</title>
</svelte:head>

<main>
	<div class="container h-full mt-12 mb-12 p-1 mx-auto justify-center items-center">
		<div class="card variant-soft mb-10">
			<header class="card-header">
				<h1 class="h1">FDJ Forecast</h1>
			</header>
			<section class="p-4">
				<p>
					This GitHub project is an artificial intelligence and neural networks to generate
					forecasts and predictions for lottery numbers.
				</p>

				<p>
					It's important to note that using neural networks or any form of AI to predict lottery
					numbers is for educational and entertainment purposes only.
				</p>

				<p>
					The lottery is a game of chance, and no prediction system can guarantee winning numbers.
				</p>
			</section>
			<footer class="card-footer flex justify-center items-center">
				<a href="https://github.com/Ealenn/fdj-forecast" class="btn variant-soft">
					<span>
						<Avatar src="https://avatars.githubusercontent.com/u/13718470?v=4&s=32" width="w-8" />
					</span>
					<span>Ealenn/FDJ-Forecast</span>
				</a>
			</footer>
		</div>

		<Table source={tableSimple} />
	</div>
</main>
